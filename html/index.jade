doctype html
html(lang='en')
  head
    title Music Top 100 Youtube
    meta(charset='UTF-8')
    link(rel='stylesheet', type='text/css', href='/bootstrap.min.css')
    link(rel='stylesheet', type='text/css', href='/style.css')
    script.
      window.onload = function(){
        let trObj = document.getElementsByName('trtr');
        let url = document.URL.replace(new RegExp('(\/song)(.*)'), '$1');
        for(let i = 0, len = trObj.length; i < len; i++){
          trObj[i].onclick = function(){
            window.location.href = url+'/'+trObj[i].getAttribute("index");
          };
        }
      }
  body
    div#iframeDiv
      if url
        div(class="embed-responsive embed-responsive-4by3")
          div#player(class="embed-responsive-item")
            script(src='http://www.youtube.com/player_api')
            script.
              // Create youtube player
              var player;
              // videoId : 공유URL(http://youtu.be/UaY9xbHmVAc)에서 'http://youtu.be'만 제거한 아이디
              // playerVars : autoplay-자동시작, controls-하단컨트롤 사용여부, html5-html5 사용여부
              function onYouTubePlayerAPIReady() {
                player = new YT.Player('player', {
                  //- height: '480',
                  //- width: '853',
                  height: '100%',
                  width: '100%',
                  videoId: '#{url}',
                  playerVars: { 'autoplay': 1, 'controls': 1, 'html5': 1 },
                  events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                  }
                });
              }
              
              console.log('index...','#{index}')

              // autoplay video
              function onPlayerReady(event) {
              //동영상 로드가 끝난 후 이벤트
                //- alert("동영상 로드");
              }
              // when video ends
              function onPlayerStateChange(event) {
                if(event.data === 0) {
                //동영상 끝난 후 이벤트
                  
                }
              }
            //- iframe(class="embed-responsive-item", src='#{url}')
    div#content
      div#listDiv
        table(class='table table-striped table-hover')
          tr
            th #
            th song
            th singer
          each obj in result
            if obj.class
              tr(class="#{obj.class}" name='trtr' index='#{obj.num}')
                td #{obj.num+1}
                td #{obj.song} 
                td #{obj.singer}
            else
              tr(name='trtr' index='#{obj.num}' focus)
                td #{obj.num+1}
                td #{obj.song} 
                td #{obj.singer}